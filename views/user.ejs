<%- include('partials/header'); -%>

<p><%=loginUser.emailLogin%></p>
<p><%=loginUser.isAdminLogin%></p>

<% if (loginUser.isAdminLogin == true) { %>

<div class="content container">
  <form action="/user/email" method="post">
    <div class="input-group mb-3 rounded w-50">
      <input
        type="text"
        class="form-control rounded"
        placeholder="Search users information by email"
        aria-label="Search"
        name="emailSearch"
      />
      <button id="search-button" type="submit" class="btn btn-primary">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </form>
  <h1>Users</h1>


  <button
  type="button"
  class="btn btn-primary"
  data-toggle="modal"
  data-target="#changePassword"
>
  <i class="fa-solid fa-plus"></i> Change password
</button>


<!-- Modal -->
<div
  class="modal fade"
  id="changePassword"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title" id="exampleModalLabel">Change password</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="/user/change-password" method="post">
        <div class="modal-body">
           
          
          <div class="form-group">
            <input
              type="text"
              class="form-control"
              id=""
              value="<%=loginUser.emailLogin%>"
              name="email"
              hidden
            />
          </div>

          <div class="form-group"> 
            <label for="">Enter Your Current Password</label>
            <input
              type="password"
              class="form-control"
              id=""
              placeholder="Enter Your Current Password"
              name="currentPassword"
            />
          </div>

          <div class="form-group">
            <label for="">Enter Your New Password</label>
            <input
              type="password"
              class="form-control"
              id=""
              placeholder="Enter Your New Password"
              name="newPassword"
            />
          </div>

          <div class="form-group">
            <label for="">Enter Your New Password Again</label>
            <input
              type="password"
              class="form-control"
              id=""
              placeholder="Enter Your New Password Again"
              name="newPasswordAgain"
            />
          </div>
          
          
        </div>
        <div class="modal-footer border-top-0 d-flex justify-content-center">
          <button type="submit" class="btn btn-success">Commit Change</button>
        </div>
      </form>
    </div>
  </div>
</div>




  <button
    type="button"
    class="btn btn-primary"
    data-toggle="modal"
    data-target="#addNewUser"
  >
    <i class="fa-solid fa-plus"></i> New
  </button>

  <!-- Modal -->
  <div
    class="modal fade"
    id="addNewUser"
    tabindex="-1"
    role="dialog"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header border-bottom-0">
          <h5 class="modal-title" id="exampleModalLabel">Add New User</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form action="/user/create-new-user" method="post">
          <div class="modal-body">
            <div class="form-group">
              <label for="email1">Email address</label>
              <input
                type="email"
                class="form-control"
                id="email1"
                aria-describedby="emailHelp"
                placeholder="Enter email"
                name="email"
              />
            </div>
            <div class="form-group">
              <label for="bookIDField">Enter First Name</label>
              <input
                type="text"
                class="form-control"
                id="bookIDField"
                placeholder="Enter First Name"
                name="firstName"
              />
            </div>
            <div class="form-group">
              <label for="">Enter Last Name</label>
              <input
                type="text"
                class="form-control"
                id=""
                placeholder="Enter Last Name"
                name="lastName"
              />
            </div>
            <div class="form-group">
              <label for="">Enter Adress</label>
              <input
                type="Address"
                class="form-control"
                id=""
                placeholder="Enter Adress"
                name="address"
              />
            </div>
            <div class="form-group">
              <label for="">Enter Password</label>
              <input
                type="password"
                class="form-control"
                id=""
                placeholder="Enter Password"
                name="password"
              />
            </div>
            <div class="form-group">
              <label for="">Is Admin ?</label>
              <input
                type="text"
                class="form-control"
                id=""
                placeholder="Is Admin ?(1 is Admin, 0 is not)"
                name="isAdmin"
              />
            </div>
            <div class="form-group">
              <label for="">Enter Phone Number</label>
              <input
                type="number"
                class="form-control"
                id=""
                placeholder="Enter Phone Number"
                name="phoneNumber"
              />
            </div>
          </div>
          <div class="modal-footer border-top-0 d-flex justify-content-center">
            <button type="submit" class="btn btn-success">Add User</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <table
    class="table table-striped table-hover"
    data-toggle="table"
    data-search="true"
  >
    <caption>
      List of users in the system
    </caption>
    <thead class="thead-dark">
      <tr>
        <th scope="col">User Email</th>
        <th scope="col">First Name</th>
        <th scope="col">Last Name</th>
        <th scope="col">Address</th>
        <th scope="col">Phone Number</th>
        <th scope="col">Is Administration</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% userData.forEach((userData)=>{ %> <%let isAdminOrNot= userData.isAdmin
      || false; %>
      <p>
        <%isAdminOrNot=(!isAdminOrNot)||(userData.email==loginUser.emailLogin);%>
      </p>
      <tr>
        <td
          class="edit"
          contenteditable="false"
          id="userEmail_<%= userData.email %>"
        >
          <%= userData.email %>
        </td>
        <td
          class="edit"
          contenteditable="<%=isAdminOrNot%>"
          id="userFirstName_<%= userData.email %>"
        >
          <%= userData.firstName %>
        </td>
        <td
          class="edit"
          contenteditable="<%=isAdminOrNot%>"
          id="userLastName_<%= userData.email %>"
        >
          <%= userData.lastName %>
        </td>
        <td
          class="edit"
          contenteditable="<%=isAdminOrNot%>"
          id="userAddress_<%= userData.email %>"
        >
          <%= userData.address %>
        </td>
        <td
          class="edit"
          contenteditable="<%=isAdminOrNot%>"
          id="userPhoneNumber_<%= userData.email %>"
        >
          <%= userData.phoneNumber %>
        </td>

        

        <td
          class="edit"
          contenteditable="false"
          id="userIsAdmin_<%= userData.email %>"
        >
          <%= userData.isAdmin %>
        </td>
        <td>
          <% if (isAdminOrNot) { %>

          <form
            action="/user/delete-user"
            method="post"
            style="display: inline"
          >
            <input
              type="text"
              name="email"
              value="<%= userData.email%>"
              hidden
            />
            <input
              type="text"
              name="isAdmin"
              value="<%= userData.isAdmin%>"
              hidden
            />
            <button type="submit" class="btn btn-danger btn-delete">
              Delete
            </button>
          </form>

          <button
            class="btn btn-success btn-save"
            id="saveBtn_<%=userData.email%>"
          >
            Edit
          </button>

          <% } %>
        </td>
      </tr>
      <%}); %>
    </tbody>
  </table>
</div>
<script src="/js/editUser.js"></script>
<% } %>

<script
  src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
  integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
  crossorigin="anonymous"
></script>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
  integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
  crossorigin="anonymous"
></script>

<%- include('partials/footer'); -%>
